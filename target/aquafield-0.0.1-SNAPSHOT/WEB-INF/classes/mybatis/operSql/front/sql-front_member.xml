<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"> 

<mapper namespace="com.soft.web.dao.front.FrontMemberDao">

<select id="searchId" parameterType="java.util.Map" resultType="String">
 <![CDATA[
	SELECT MEM_ID 
	  FROM TB_MEMBER
	 WHERE DI_CERTI = #{di_certi}
   	   AND POINT_CODE = #{point_code}  
 ]]>	
</select>

<select id="idChk" parameterType="java.util.Map" resultType="Int">
 <![CDATA[
	SELECT COUNT(*) AS CNT 
	  FROM TB_MEMBER
	 WHERE MEM_ID = #{mem_id}
   	   AND POINT_CODE = #{point_code}  
 ]]>	
</select>

<select id="memberInfo" parameterType="java.util.Map" resultType="java.util.Map">
 <![CDATA[
	SELECT MEM_UID
		  ,xx1.dec_varchar2_sel(MEM_NM, 10, 'NAME') AS MEM_NM
		  ,MEM_ID
		  ,xx1.dec_varchar2_sel(MOBILE_NUM, 10, 'PHONE') AS MOBILE_NUM
		  ,MEM_BIRTH
		  ,BIRTH_TYPE
		  ,MEM_GENDER
		  ,xx1.dec_varchar2_sel(HOME_ADDR1, 10, 'ADDRESS') AS HOME_ADDR1
		  ,xx1.dec_varchar2_sel(HOME_ADDR2, 10, 'ADDRESS') AS HOME_ADDR2
		  ,COMPANY_NM
		  ,xx1.dec_varchar2_sel(COMPANY_ADDR1, 10, 'ADDRESS') AS COMPANY_ADDR1
		  ,xx1.dec_varchar2_sel(COMPANY_ADDR2, 10, 'ADDRESS') AS COMPANY_ADDR2
		  ,xx1.dec_varchar2_sel(COMPANY_PHONE_NUM, 10, 'PHONE') AS COMPANY_PHONE_NUM
		  ,JOB_NM
		  ,MEMORY_DAY
		  ,POINT_CODE
		  ,MEM_RATING
		  ,TERMS_AT
		  ,RECEIVED_INFO_AT
	  FROM TB_MEMBER
	 WHERE MEM_ID = #{mem_id}
	   AND MEM_PW = xx1.enc_varchar2_ins(#{mem_pw}, 10, 'PWD')
   	   AND POINT_CODE = #{point_code}  
 ]]>	
</select>

<select id="memberUpdInfo" parameterType="java.util.Map" resultType="java.util.Map">
 <![CDATA[
	SELECT MEM_UID
		  ,xx1.dec_varchar2_sel(MEM_NM, 10, 'NAME') AS MEM_NM
		  ,MEM_ID
		  ,xx1.dec_varchar2_sel(MOBILE_NUM, 10, 'PHONE') AS MOBILE_NUM
		  ,MEM_BIRTH
		  ,BIRTH_TYPE
		  ,MEM_GENDER
		  ,xx1.dec_varchar2_sel(HOME_ADDR1, 10, 'ADDRESS') AS HOME_ADDR1
		  ,xx1.dec_varchar2_sel(HOME_ADDR2, 10, 'ADDRESS') AS HOME_ADDR2
		  ,COMPANY_NM
		  ,xx1.dec_varchar2_sel(COMPANY_ADDR1, 10, 'ADDRESS') AS COMPANY_ADDR1
		  ,xx1.dec_varchar2_sel(COMPANY_ADDR2, 10, 'ADDRESS') AS COMPANY_ADDR2
		  ,xx1.dec_varchar2_sel(COMPANY_PHONE_NUM, 10, 'PHONE') AS COMPANY_PHONE_NUM
		  ,JOB_NM
		  ,MEMORY_DAY
		  ,POINT_CODE
		  ,MEM_RATING
		  ,TERMS_AT
		  ,RECEIVED_INFO_AT
	  FROM TB_MEMBER
	 WHERE MEM_UID = #{mem_uid}
 ]]>	
</select>

<select id="inactMemInfo" parameterType="java.util.Map" resultType="java.util.Map">
 <![CDATA[
	SELECT A.MEM_UID
		  ,xx1.dec_varchar2_sel(A.MEM_NM, 10, 'NAME') AS MEM_NM
		  ,A.MEM_ID
		  ,xx1.dec_varchar2_sel(A.MOBILE_NUM, 10, 'PHONE') AS MOBILE_NUM
		  ,A.MEM_BIRTH
		  ,A.BIRTH_TYPE
		  ,A.MEM_GENDER
		  ,xx1.dec_varchar2_sel(A.HOME_ADDR1, 10, 'ADDRESS') AS HOME_ADDR1
		  ,xx1.dec_varchar2_sel(A.HOME_ADDR2, 10, 'ADDRESS') AS HOME_ADDR2
		  ,A.COMPANY_NM
		  ,xx1.dec_varchar2_sel(A.COMPANY_ADDR1, 10, 'ADDRESS') AS COMPANY_ADDR1
		  ,xx1.dec_varchar2_sel(A.COMPANY_ADDR2, 10, 'ADDRESS') AS COMPANY_ADDR2
		  ,xx1.dec_varchar2_sel(A.COMPANY_PHONE_NUM, 10, 'PHONE') AS COMPANY_PHONE_NUM
		  ,A.JOB_NM
		  ,A.MEMORY_DAY
		  ,A.POINT_CODE
		  ,A.MEM_RATING
		  ,A.TERMS_AT
		  ,A.RECEIVED_INFO_AT
		  ,B.INACTIVITY_UID
		  ,B.LAST_LOGIN_DATE
		  ,B.INACTIVITY_AT
		  ,B.INACTIVITY_DATE
		  ,B.SEND_MAIL_DATE
	 FROM TB_MEMBER A, TB_MEMBER_INACTIVITY B
	WHERE A.MEM_UID = B.MEM_UID
	  AND B.INACTIVITY_AT = 'Y'
	  AND A.POINT_CODE = #{point_code}
	  AND A.MEM_ID = #{mem_id}
		AND A.MEM_PW = xx1.enc_varchar2_ins(#{mem_pw}, 10, 'PWD')
 ]]>	
</select>

<update id="lastLoginUpd" parameterType="Int">
 <![CDATA[
	UPDATE TB_MEMBER SET LAST_LOGIN_DATE = sysdate
	 			   WHERE MEM_UID = #{mem_uid}
 ]]>	
</update>

<update id="setInactMem" parameterType="java.util.Map">
 <![CDATA[
 	UPDATE TB_MEMBER SET MEM_NM = xx1.enc_varchar2_ins(#{mem_nm}, 10, 'NAME')
 						,MOBILE_NUM = xx1.enc_varchar2_ins(#{mobile_num}, 10, 'PHONE')
 						,HOME_ADDR1 = xx1.enc_varchar2_ins(#{home_addr1}, 10, 'ADDRESS')
 						,HOME_ADDR2 = xx1.enc_varchar2_ins(#{home_addr2}, 10, 'ADDRESS') 
				   WHERE MEM_UID = #{mem_uid} 
 ]]>
</update> 

<update id="setPassword" parameterType="java.util.Map">
 <![CDATA[
 	UPDATE TB_MEMBER SET MEM_PW = xx1.enc_varchar2_ins(#{mem_pw}, 10, 'PWD')
				   WHERE DI_CERTI = #{di_certi}
				     AND POINT_CODE = #{point_code}  
 ]]>
</update>  

<update id="memberUpd" parameterType="java.util.Map">

	UPDATE TB_MEMBER SET MEM_BIRTH = #{mem_birth}
	                    ,BIRTH_TYPE = #{birth_type}
	                    ,MEM_GENDER = #{mem_gender}
	                    ,HOME_ADDR1 = xx1.enc_varchar2_ins(#{home_addr1}, 10, 'ADDRESS')
	                    ,HOME_ADDR2 = xx1.enc_varchar2_ins(#{home_addr2}, 10, 'ADDRESS')
	                    ,UPD_ID = #{upd_id}
	                    ,UPD_DATE = sysdate
				<if test = "mem_pw != null and mem_pw != ''">
                        ,MEM_PW = #{mem_pw}				
				</if>	                    
				   WHERE MEM_UID = #{mem_uid} 		                      
</update>
	
<insert id="memberJoin" parameterType="java.util.Map">
   <![CDATA[
	INSERT INTO TB_MEMBER (MEM_UID
	                      ,MEM_NM
	                      ,MEM_ID
	                      ,MEM_PW
	                      ,MOBILE_NUM
	                      ,MEM_BIRTH
	                      ,BIRTH_TYPE
	                      ,MEM_GENDER
	                      ,HOME_ADDR1
	                      ,HOME_ADDR2
	                      ,COMPANY_PHONE_NUM
	                      ,COMPANY_NM
	                      ,COMPANY_ADDR1
	                      ,COMPANY_ADDR2
	                      ,MEMORY_DAY
	                      ,TERMS_AT
	                      ,RECEIVED_INFO_AT
	                      ,MEM_RATING
	                      ,POINT_CODE
	                      ,INS_ID
	                      ,INS_DATE
	                      ,DI_CERTI) 
	              VALUES (TB_MEMBER_SEQ.NEXTVAL
	                      ,xx1.enc_varchar2_ins(UTL_RAW.CAST_TO_VARCHAR2(#{mem_nm}), 10, 'NAME')
	                      ,#{mem_id}
	                      ,xx1.enc_varchar2_ins(#{mem_pw}, 10, 'PWD')
	                      ,xx1.enc_varchar2_ins(#{mobile_num}, 10, 'PHONE')
	                      ,#{mem_birth}
	                      ,#{birth_type}
	                      ,#{mem_gender}
	                      ,xx1.enc_varchar2_ins(#{home_addr1}, 10, 'ADDRESS')
	                      ,xx1.enc_varchar2_ins(#{home_addr2}, 10, 'ADDRESS')
	                      ,xx1.enc_varchar2_ins(#{company_phone_num}, 10, 'PHONE')
	                      ,#{company_nm}
	                      ,xx1.enc_varchar2_ins(#{company_addr1}, 10, 'ADDRESS')
	                      ,xx1.enc_varchar2_ins(#{company_addr2}, 10, 'ADDRESS')
	                      ,#{memory_day}
	                      ,#{terms_at}
	                      ,#{received_info_at}
	                      ,#{mem_rating}
	                      ,#{point_code}
	                      ,#{ins_id}
	                      ,sysdate
	                      ,#{ci_certi})
		]]>	 		                      
</insert>

<delete id="inactMemDel" parameterType="java.util.Map">
 <![CDATA[
 	DELETE TB_MEMBER_INACTIVITY 
						  WHERE MEM_UID = #{mem_uid}
 ]]>
</delete>

</mapper>
