<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%><%@ include file="../../common/taglibs.jsp" %><script type="text/javascript">	var page = 1;		$( document ).ready(function() {		var today = new Date();		var thisYear = today.getFullYear();		var thisMonth = today.getMonth();				var startDayOfMonth = $.datepicker.formatDate('yy.mm.dd', new Date(thisYear, thisMonth, 1));		var endDayOfMonth = $.datepicker.formatDate('yy.mm.dd', new Date(thisYear, thisMonth+1, 0));				//datepicker 선택하기		$("input[name=srch_pay_s]").val(startDayOfMonth);		$("input[name=srch_pay_e]").val(endDayOfMonth);				doSearch();				//시작일-종료일 유효성		$("input[name='srch_pay_s']").datepicker("option", "maxDate", $("input[name='srch_pay_e']").val());	    $("input[name='srch_pay_s']").datepicker("option", "onClose", function ( selectedDate ) {	        $("input[name='srch_pay_e']").datepicker( "option", "minDate", selectedDate );	    });	 	    $("input[name='srch_pay_e']").datepicker("option", "minDate", $("input[name='srch_pay_s']").val());	    $("input[name='srch_pay_e']").datepicker("option", "onClose", function ( selectedDate ) {	        $("input[name='srch_pay_s']").datepicker( "option", "maxDate", selectedDate );	    });	    	  	//시작일-종료일 유효성	    $("input[name='srch_reg_s']").datepicker("option", "maxDate", $("input[name='srch_reg_e']").val());	    $("input[name='srch_reg_s']").datepicker("option", "onClose", function ( selectedDate ) {	        $("input[name='srch_reg_e']").datepicker( "option", "minDate", selectedDate );	    });	 	    $("input[name='srch_reg_e']").datepicker("option", "minDate", $("input[name='srch_reg_s']").val());	    $("input[name='srch_reg_e']").datepicker("option", "onClose", function ( selectedDate ) {	        $("input[name='srch_reg_s']").datepicker( "option", "maxDate", selectedDate );	    });	});	function getData(){		var formData = $("#search_form").serialize();		//if(page == 1){  			$(".tb_type1").find("tbody *").remove();		//}		//합계행이 존재하는 것으로 보아, 페이징은 더이상 없음.		if($("#totalArea").length > 0){			return false;		}		//ajax 데이터 가져오기		$.ajax({			async: false,			method: "POST",			url: "/secu_admaf/ajax/statistics/ajax_totalData.af",			data : formData,			dataType: "html",			success:function(data){				$(".tb_type1").find("tbody").append(data);				$(".result_summary").find("strong").text($("input[name=totCnt]").val());				$("input[name=page]").val(page);								var trLength = parseInt($(".tb_type1").find("tbody tr").length);				var totCnt = parseInt($("input[name=totCnt]").val());								if(trLength == totCnt){					var html = "";					html += '<tr id="totalArea">';					html += '<th colspan="12" class="right">합계</th>';					html += '<td id="paymentSum" class="price sum"></td>';					html += '<td id="refundSum" class="price sum"></td>';					html += '<td id="panaltySum" class="price sum"></td>';					html += '<td></td>';					html += '</tr>';					$(".tb_type1").find("tbody").append(html);				}								if($("#totalArea").length > 0){					var paymentSum = 0;					var refundSum = 0;					var panaltySum = 0;										$(".payment").each(function(){						if($(this).text() != "0"){							var value = $(this).text().replace(/,/g, ''); 							paymentSum += parseInt(value);						}					});					$(".refund").each(function(){						if($(this).text() != "0"){							var value = $(this).text().replace(/,/g, ''); 							refundSum += parseInt(value);						}					});					$(".panalty").each(function(){						if($(this).text() != "0"){							var value = $(this).text().replace(/,/g, ''); 							panaltySum += parseInt(value);						}					});										$("#paymentSum").text(paymentSum);					$("#refundSum").text(refundSum);					$("#panaltySum").text(panaltySum);										//가격 콤파 추가				    $(".sum").each(function(){				    	$(this).text($(this).text().replace(/\B(?=(\d{3})+(?!\d))/g, ","));				    });				}			},			error : function(xhr, status, error) {                 alert("알 수 없는 오류가 발생하였습니다.");                 return false;           }		});	}		//검색	function doSearch(){		$("input[name='page']").val("1");		page = 1;		getData();	};	    function moreData(){		var page = $("input[name=page]").val();		$("input[name=page]").val(parseInt(page)+1);		getData();    }       //스크롤 이벤트 최초 발생    $(window).scroll(function(){    	//현재 스크롤의 위치가 화면의 보이는 위치보다 크다면    	if($(window).scrollTop() == $(document).height() - $(window).height()){    		//합계행이 존재하는 것으로 보아, 페이징은 더이상 없음.    		if($("#totalArea").length > 0){    			return false;    		}    		//ajax 서버에 게시물 데이터 요청    		page = parseInt($("input[name=page]").val());    		page++;    		$("input[name=page]").val(page);    		getData();    	}    });          //예약정보 바로보기 팝업  function showResPanel(resIdx){  	$("#resLinkIdx").focusout();  	ajaxShowPopCont({  		url : "/secu_admaf/admin/reservation/ajax_res_view.af",  		data : { reserve_uid : resIdx}  	});  }	//엑셀 다운로드  function excelDownload(){	  if(!confirm('다운로드 하시겠습니까?')) return;	var temp_url = document.search_form.action;	document.search_form.action = "/secu_admaf/admin/statistics/res_excel_down.af";	document.search_form.target="_blank";	document.search_form.submit();	// 다운로드 후 form 옵션 초기화	document.search_form.action = temp_url;	document.search_form.target="_self";  }		//상세 이동	function goDetail(idx){		$("#resLinkIdx").val(idx);		document.serach_form.action = "/secu_admaf/admin/reservation/res_edit.af";		document.serach_form.submit();	}</script><section id="contents" style="min-width:1200px;max-width:100%;">	<div class="contents_bx_type1">		<div class="contents_bx_inner">			<div id="path" class="fixed">				<div class="pathInner">					<h2>개별회원</h2>					<div class="btns_area"> 						<button type="button" class="btn_pack btn_mo green2" onclick="excelDownload()"><img src="/admaf/images/common/ico_excel.png" alt="회원리스트"> Exel</button>					</div>				</div>			</div>			<form name="search_form" id="search_form" action="/secu_admaf/admin/statistics/totalData.af" method="post">				<input type="hidden" name="reserve_uid" id="resLinkIdx" value=""/>				<div class="tb_type2">					<h3>조건검색</h3>					<table>						<tbody>							<tr>								<th>카테고리</th>								<td colspan="3">									<div class="lst_check radio">										<span <c:if test="${empty resultParam.category || resultParam.category eq '' }">class="on"</c:if>>											<label>												전체<input type="radio" name="category" id="" value="" onclick="checkradio(this);" <c:if test="${empty resultParam.category || resultParam.category eq '' }">checked=""</c:if>>											</label>										</span>										<span <c:if test="${not empty resultParam.category && resultParam.category eq '0' }">class="on"</c:if>>											<label>												입장상품<input type="radio" name="category" id="" value="0" onclick="checkradio(this);" <c:if test="${not empty resultParam.category && resultParam.category eq '0' }">checked=""</c:if>>											</label>										</span>										<span <c:if test="${not empty resultParam.category && resultParam.category eq '1' }">class="on"</c:if>>											<label>												패키지<input type="radio" name="category" id="" value="1" onclick="checkradio(this);" <c:if test="${not empty resultParam.category && resultParam.category eq '1' }">checked=""</c:if>>											</label>										</span>									</div>								</td>							</tr>							<tr>								<th>상태</th>								<td colspan="3">									<div class="lst_check radio">										<span <c:if test="${empty resultParam.reserve_state || resultParam.reserve_state eq '' }">class="on"</c:if>>											<label>												전체<input type="radio" name="reserve_state" id="" value="" onclick="checkradio(this);" <c:if test="${empty resultParam.category || resultParam.category eq '' }">checked=""</c:if>>											</label>										</span>										<c:forEach items="${codeRSRVT_TYPE }" var="code" >											<span <c:if test="${not empty resultParam.reserve_state && resultParam.reserve_state eq code.CODE_ID }">class="on"</c:if>>												<label>													${code.CODE_NM }<input type="radio" name="reserve_state" id="" value="${code.CODE_ID }" onclick="checkradio(this);" <c:if test="${not empty resultParam.category && resultParam.category eq '0' }">checked=""</c:if>>												</label>											</span>										</c:forEach>									</div>								</td>							</tr>							<tr>								<th>이용시설</th>								<td colspan="3">									<div class="lst_check radio">										<span <c:if test="${empty resultParam.reserve_state || resultParam.reserve_state eq '' }">class="on"</c:if>>											<label>												전체<input type="radio" name="item_type" id="" value="" onclick="checkradio(this);" <c:if test="${empty resultParam.category || resultParam.category eq '' }">checked=""</c:if>>											</label>										</span>										<c:forEach items="${ePlaceList }" var="code" >											<span <c:if test="${not empty resultParam.reserve_state && resultParam.reserve_state eq code.CODE_ID }">class="on"</c:if>>												<label>													${code.ITEM_NM }<input type="radio" name="item_type" id="" value="${code.COLUMN_NM }" onclick="checkradio(this);" <c:if test="${not empty resultParam.category && resultParam.category eq '0' }">checked=""</c:if>>												</label>											</span>										</c:forEach>									</div>								</td>							</tr>							<tr>								<th>지점</th>								<td>									<select name="srch_point" id="srch_point" class="customized-select">										<c:forEach items="${codePOINT_CODE }" var="code" >											<option value="${code.CODE_ID }" <c:if test="${resultParam.srch_point == code.CODE_ID }">selected="selected"</c:if> >${code.CODE_NM }</option>										</c:forEach>									</select>								</td>								<th>결제수단</th>								<td>									<select name="payment_type" id="payment_type" class="customized-select">										<option value="">전체</option>										<c:forEach items="${codePAY_TYPE }" var="code" >											<option value="${code.CODE_ID }" <c:if test="${resultParam.srch_point == code.CODE_ID }">selected="selected"</c:if> >${code.CODE_NM }</option>										</c:forEach>									</select>								</td>							</tr>							<tr>								<th>연락처</th>								<td>									<input type="text" name="mem_mobile" id="mem_mobile" value="${resultParam.mem_mobile }" class="ipt2 w100p" onkeydown="return onlyNumber(event);" onkeyup="removeChar(event);" style='ime-mode:disabled;'/>								</td>								<th>예약번호</th>								<td>									<input type="text" name="reserve_uid" id="reserve_uid" value="${resultParam.reserve_uid }" class="ipt2 w100p" onkeydown="return onlyNumber(event);" onkeyup="removeChar(event);" style='ime-mode:disabled;'/>								</td>							</tr>							<tr>								<th>이름</th>								<td colspan="3">									<input type="text" name="mem_nm" id="mem_nm" value="${resultParam.mem_nm }" class="ipt2 w100p" style='ime-mode:disabled;'/>								</td>							</tr>							<tr>								<th>결제일</th>								<td>									<input type="text" name="srch_pay_s" class="ipt2 datepicker" value="${resultParam.srch_pay_s }" maxlength="10"/>									 ~ 									<input type="text" name="srch_pay_e" class="ipt2 datepicker" value="${resultParam.srch_pay_e }" maxlength="10"/>								</td>								<th>방문일</th>								<td>									<input type="text" name="srch_reg_s" class="ipt2 datepicker" value="${resultParam.srch_reg_s }" maxlength="10"/>									 ~ 									<input type="text" name="srch_reg_e" class="ipt2 datepicker" value="${resultParam.srch_reg_e }" maxlength="10"/>								</td>							</tr>							<tr>								<th colspan="4">									<div class="tb_btn_area center">										<button class="btn_pack btn_mo d_gray" type="button" onclick="doSearch();">Search</button>									</div>								</th>							</tr>						</tbody>					</table>				</div>				<input type="hidden" name="page" value="${page }">				<div style="text-align:right;">*Excel 다운로드는 가급적 <b>1개월 단위</b>로 진행해주세요.(로딩이 걸릴 수 있습니다.)</div>			</form>			<div class="tb_type1" style="width:100%;height:500px;overflow-y:scroll;white-space:nowrap;padding-right:5px;">				<h3>검색결과</h3>				<div class="result_summary">Total : <strong>${totCnt }</strong></div>				<table>				 	<colgroup>				 		<col width="3%"/> 						<col width="4%"/> 						<col width="11%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 						<col width="6%"/> 					</colgroup>				 	<thead>				 		<tr>				 			<th>순번</th>				 			<th>지점</th>				 			<th>이름</th>				 			<th>연락처</th>				 			<th>예약번호</th>							<th>결제일</th>							<th>방문일</th>							<th>카테고리</th>							<th>이용시설</th>							<th>상태</th>							<th>결제수단</th>							<th>인원</th>							<th>결제금액</th>							<th>취소금액</th>							<th>위약금</th>							<th>관리</th>						</tr>				 	</thead>					<tbody>						<c:forEach items="${rList }" var="vo" >							<tr>								<td>${vo.RN }</td>								<td>${vo.POINT_NM }</td>								<td>									<c:choose>										<c:when test="${MEMINFOYN eq 'Y'}">											${vo.MEM_NM }																				</c:when>										<c:otherwise>											${vo.MASK_MEM_NM }										</c:otherwise>									</c:choose>								</td>								<td>									<c:choose>										<c:when test="${MEMINFOYN eq 'Y'}">											${vo.MEM_MOBILE }																				</c:when>										<c:otherwise>											${vo.MASK_MEM_MOBILE }										</c:otherwise>									</c:choose>								</td>								<td>${vo.PAYMENT_DATE }</td>								<td>									<a href="javascript:void(0)" class="link" onclick="showResPanel('${vo.ORDER_NUM}')">										${vo.ORDER_NUM }									</a>								</td>								<td>${vo.PAYMENT_DATE }</td>								<td>${vo.RESERVE_DATE }</td>								<td>${vo.ORDER_NM }</td>								<td>									<c:choose>										<c:when test="${vo.ORDER_TP eq '0' }">											<c:forEach items="${fn:split(vo.ENTER_ITEM_NM, ',') }" var="item" varStatus="status">											    ${item}<br/>											</c:forEach>										</c:when>										<c:otherwise>											<c:forEach items="${fn:split(vo.PACKAGE_ITEM_NM, ',') }" var="item" varStatus="status">											    ${item}<br/>											</c:forEach>										</c:otherwise>									</c:choose>								</td>								<c:choose>									<c:when test="${vo.RESERVE_STATE eq 'ING' }">										<c:set var="color" value="res" />									</c:when>									<c:when test="${vo.RESERVE_STATE eq 'USE' || vo.RESERVE_STATE eq 'NOUSE' }">										<c:set var="color" value="" />									</c:when>									<c:otherwise>										<c:set var="color" value="cancel" />									</c:otherwise>								</c:choose>								<td class="stat ${color }">${vo.RESERVE_STATE_NM }</td>								<td>${vo.PAYMENT_TYPE_NM }</td>								<td>${vo.TOTNUM }</td>								<td class="price payment"><fmt:formatNumber value="${vo.PAYMENT_PRICE }" pattern="#,###"/></td>								<td class="price refund"><fmt:formatNumber value="${vo.REFUND }" pattern="#,###"/></td>								<td class="price panalty">									<c:choose>										<c:when test="${vo.PANALTY_PRICE eq null || vo.PANALTY_PRICE eq ''}">											0										</c:when>										<c:otherwise>											<fmt:formatNumber value="${vo.PANALTY_PRICE }" pattern="#,###"/>													</c:otherwise>									</c:choose>								</td>								<td>									<c:if test="${vo.RESERVE_STATE ne 'NOPMT'}">										<a href="#" onclick="goDetail('${vo.ORDER_NUM}'); return false;" class="link">수정</a>									</c:if>								</td>							</tr>						</c:forEach>						<c:if test="${empty rList }">							<tr id="totalArea">								<td colspan="16"> 조회된 내용이 없습니다. </td>							<tr>						</c:if>					</tbody>				</table>			</div>			<!-- <div class="paginate">				<button class="btn_pack btn_mo d_gray" type="button" id="btnMore" onclick="moreData();">더보기</button>			</div> -->			<%-- <div class="paginate">				<c:if test="${pu.blockStartNum > 1 }">					<a href="javascript:;" onclick="doPaging('${pu.blockStartNum - 1 }');" class="btn prev disable">PREV</a>				</c:if>				<c:forEach var="i" begin="${pu.blockStartNum}" end="${pu.blockEndNum }">					<a href="javascript:;" onclick="doPaging('${i}');" class="num <c:if test="${i == pu.pageNum }">on</c:if>">${i}</a>				</c:forEach>				<c:if test="${pu.blockEndNum < pu.pageTotalCount }">					<a href="javascript:;" onclick="doPaging('${pu.blockEndNum + 1 }');" class="btn next">NEXT</a>				</c:if>			</div> --%>		</div>	</div></section>